namespace SpriteKind {
    export const Turret = SpriteKind.create()
    export const CameraTrigger = SpriteKind.create()
    export const HUD = SpriteKind.create()
    export const OffscreenProjectile = SpriteKind.create()
    export const DestroyedPlayer = SpriteKind.create()
}
controller.up.onEvent(ControllerButtonEvent.Pressed, function () {
    handleDirectionInput(0, 1, 0, -10)
})
controller.B.onEvent(ControllerButtonEvent.Pressed, function () {
    if (canShoot) {
        updateInputMode((inputMode + 1) % 2)
        offscreenHorizontally = tankSprite.right < scene.cameraLeft() || tankSprite.left > scene.cameraLeft() + scene.screenWidth()
        offscreenVertically = tankSprite.bottom < scene.cameraTop() || tankSprite.top > scene.cameraTop() + scene.screenHeight()
        if (offscreenHorizontally || offscreenVertically) {
            scene.centerCameraAt(tankSprite.x, tankSprite.y - 8)
        }
    }
})
controller.up.onEvent(ControllerButtonEvent.Repeated, function () {
    handleDirectionInput(0, 2, 0, -5)
})
function cameraFollowSprite (toFollow: Sprite) {
    scene.cameraFollowSprite(shot)
    cameraSprite = shot
}
controller.A.onEvent(ControllerButtonEvent.Pressed, function () {
    if (canShoot) {
        canShoot = false
        updateInputMode(1)
        shot = sprites.create(img`
            . . . . . 
            . . 4 . . 
            . 4 8 4 . 
            . . 4 . . 
            . . . . . 
            `, SpriteKind.Projectile)
        positionSpriteRelativeTo(turretSprite, sprites.readDataNumber(tankSprite, "turretEndX") - turretSpriteHalfWidth, sprites.readDataNumber(tankSprite, "turretEndY") - turretSpriteHalfWidth, shot)
        if (sprites.allOfKind(SpriteKind.Projectile).length == 1) {
            cameraFollowSprite(shot)
        }
        shot.ay = 100
        shot.ax = windSpeed
        shot.setFlag(SpriteFlag.DestroyOnWall, true)
        shot.vx = sprites.readDataNumber(tankSprite, "turretUnitX") * sprites.readDataNumber(tankSprite, "shotPower")
        shot.vy = sprites.readDataNumber(tankSprite, "turretUnitY") * (0 - sprites.readDataNumber(tankSprite, "shotPower"))
    }
})
sprites.onOverlap(SpriteKind.Projectile, SpriteKind.Player, function (sprite, otherSprite) {
    sprite.destroy()
    tankToDeleteIndex = tankSprites.indexOf(otherSprite)
    if (tankToDeleteIndex <= activePlayer) {
        activePlayer += -1
    }
    turretSprites.removeAt(tankToDeleteIndex).destroy()
    tankSprites.removeAt(tankToDeleteIndex).destroy(effects.fire, 500)
    viewTrigger = sprites.create(image.create(0, 0), SpriteKind.CameraTrigger)
    viewTrigger.lifespan = 3000
})
controller.right.onEvent(ControllerButtonEvent.Repeated, function () {
    handleDirectionInput(-3, 0, 5, 0)
})
controller.left.onEvent(ControllerButtonEvent.Pressed, function () {
    handleDirectionInput(1, 0, -10, 0)
})
function updateHUDValue (hudSprite: Sprite, value: string) {
    hudSprite.image.fillRect(0, 0, hudSprite.width, hudSprite.height, 0)
    localExtensions.drawText5In(
    value,
    hudSprite.image,
    0,
    0,
    1
    )
}
function drawTurrent () {
    sprites.setDataNumber(tankSprite, "turretAngle", (sprites.readDataNumber(tankSprite, "turretAngle") + 360) % 360)
    sprites.setDataNumber(tankSprite, "shotPower", Math.constrain(sprites.readDataNumber(tankSprite, "shotPower"), 0, 350))
    turretSprite.setImage(image.create(turretSprite.width, turretSprite.height))
    sprites.setDataNumber(tankSprite, "turretAngleRad", sprites.readDataNumber(tankSprite, "turretAngle") * (3.14159 / 180))
    sprites.setDataNumber(tankSprite, "turretUnitX", Math.cos(sprites.readDataNumber(tankSprite, "turretAngleRad")))
    sprites.setDataNumber(tankSprite, "turretUnitY", Math.sin(sprites.readDataNumber(tankSprite, "turretAngleRad")))
    sprites.setDataNumber(tankSprite, "turretEndX", Math.round(sprites.readDataNumber(tankSprite, "turretUnitX") * turretLength + turretSpriteHalfWidth))
    sprites.setDataNumber(tankSprite, "turretEndY", Math.round(turretSpriteHalfWidth - sprites.readDataNumber(tankSprite, "turretUnitY") * turretLength))
    turretSprite.image.drawLine(turretSpriteHalfWidth, turretSpriteHalfWidth, sprites.readDataNumber(tankSprite, "turretEndX"), sprites.readDataNumber(tankSprite, "turretEndY"), 8)
    updateHUDValue(powerLabel, convertToText(sprites.readDataNumber(tankSprite, "shotPower")))
    updateHUDValue(angleLabel, convertToText(sprites.readDataNumber(tankSprite, "turretAngle")))
}
function initAllHUDSprites () {
    panIndicator = sprites.create(img`
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ...............................................................................666..............................................................................
        ..............................................................................66166.............................................................................
        .............................................................................6611166............................................................................
        ............................................................................661111166...........................................................................
        ...........................................................................66111611166..........................................................................
        ..........................................................................6611166611166.........................................................................
        .........................................................................6611166.6611166........................................................................
        ........................................................................6611166...6611166.......................................................................
        ........................................................................611166.....661116.......................................................................
        ........................................................................61166.......66116.......................................................................
        ........................................................................6166.........6616.......................................................................
        ........................................................................666...........666.......................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ............66666...............................................................................................................................66666...........
        ...........661116...............................................................................................................................611166..........
        ..........6611166...............................................................................................................................6611166.........
        .........6611166.................................................................................................................................6611166........
        ........6611166...................................................................................................................................6611166.......
        .......6611166.....................................................................................................................................6611166......
        ......6611166.......................................................................................................................................6611166.....
        .....6611166.........................................................................................................................................6611166....
        .....611166...........................................................................................................................................661116....
        .....6611166.........................................................................................................................................6611166....
        ......6611166.......................................................................................................................................6611166.....
        .......6611166.....................................................................................................................................6611166......
        ........6611166...................................................................................................................................6611166.......
        .........6611166.................................................................................................................................6611166........
        ..........6611166...............................................................................................................................6611166.........
        ...........661116...............................................................................................................................611166..........
        ............66666...............................................................................................................................66666...........
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ........................................................................666...........666.......................................................................
        ........................................................................6166.........6616.......................................................................
        ........................................................................61166.......66116.......................................................................
        ........................................................................611166.....661116.......................................................................
        ........................................................................6611166...6611166.......................................................................
        .........................................................................6611166.6611166........................................................................
        ..........................................................................6611166611166.........................................................................
        ...........................................................................66111611166..........................................................................
        ............................................................................661111166...........................................................................
        .............................................................................6611166............................................................................
        ..............................................................................66166.............................................................................
        ...............................................................................666..............................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        `, SpriteKind.HUD)
    windLegend = sprites.create(img`
        . . . . . . . . . . . . . . . . . . . . 
        1 . . . 1 . . 1 . . 1 . . 1 . . 1 1 1 . 
        1 . . . 1 . . 1 . . 1 1 . 1 . . 1 . . 1 
        1 . 1 . 1 . . 1 . . 1 1 1 1 . . 1 . . 1 
        1 . 1 . 1 . . 1 . . 1 . 1 1 . . 1 . . 1 
        1 1 1 1 . . . 1 . . 1 . . 1 . . 1 1 1 . 
        . . . . . . . . . . . . . . . . . . . . 
        `, SpriteKind.HUD)
    windLegend.image.replace(1, hudTextColor)
    windIndicator = sprites.create(img`
        . . . . . . . 1 1 . . . 
        . . . . . . . 1 1 1 . . 
        1 1 1 1 1 1 1 1 1 1 1 . 
        1 1 1 1 1 1 1 1 1 1 1 1 
        1 1 1 1 1 1 1 1 1 1 1 . 
        . . . . . . . 1 1 1 . . 
        . . . . . . . 1 1 . . . 
        `, SpriteKind.HUD)
    windIndicator.image.replace(1, hudTextColor)
    windLabel = sprites.create(image.create(12, 5), SpriteKind.HUD)
    updateHUDValue(windLabel, convertToText(Math.abs(windSpeed)))
    legend = sprites.create(img`
        . . . 1 1 . . . 
        . . . . 1 1 1 . 
        1 1 1 1 1 1 1 1 
        . . . . 1 1 1 . 
        . . . 1 1 . . . 
        . . . . . . . . 
        . 1 . . . . . . 
        . 1 . . . . . . 
        . 1 1 1 . . . . 
        . 1 . . 1 . . . 
        . 1 . . . 1 . . 
        . 1 1 1 1 1 1 . 
        `, SpriteKind.HUD)
    legend.image.replace(1, hudTextColor)
    angleLabel = sprites.create(image.create(26, 5), SpriteKind.HUD)
    powerLabel = sprites.create(image.create(26, 5), SpriteKind.HUD)
    initHUDSprite(windLegend, scene.screenWidth() - 54, 3)
    initHUDSprite(windIndicator, scene.screenWidth() - 30, 3)
    initHUDSprite(windLabel, scene.screenWidth() - 14, 4)
    initHUDSprite(panIndicator, 0, 0)
    initHUDSprite(legend, 2, scene.screenHeight() - 14)
    initHUDSprite(angleLabel, 12, scene.screenHeight() - 7)
    initHUDSprite(powerLabel, 12, scene.screenHeight() - 14)
    if (windSpeed == 0) {
        windLegend.setFlag(SpriteFlag.Invisible, true)
        windIndicator.setFlag(SpriteFlag.Invisible, true)
        windLabel.setFlag(SpriteFlag.Invisible, true)
    } else if (windSpeed < 0) {
        windIndicator.image.flipX()
    }
}
sprites.onDestroyed(SpriteKind.CameraTrigger, function (sprite) {
    if (sprites.allOfKind(SpriteKind.CameraTrigger).length == 0 && sprites.allOfKind(SpriteKind.Projectile).length == 0) {
        canShoot = true
        updateActivePlayer((activePlayer + 1) % tankSprites.length)
        scene.centerCameraAt(tankSprite.x, tankSprite.y - 8)
        if (sprites.allOfKind(SpriteKind.Player).length == 1) {
            game.over(true)
        }
    }
})
function initHUDSprite (hudSprite: Sprite, left: number, top: number) {
    hudSprite.setFlag(SpriteFlag.RelativeToCamera, true)
    hudSprite.left = left
    hudSprite.top = top
    hudSprite.z = 100
}
controller.right.onEvent(ControllerButtonEvent.Pressed, function () {
    handleDirectionInput(-1, 0, 10, 0)
})
function updateInputMode (mode: number) {
    inputMode = mode
    panIndicator.setFlag(SpriteFlag.Invisible, inputMode != 0)
    legend.setFlag(SpriteFlag.Invisible, inputMode == 0)
    powerLabel.setFlag(SpriteFlag.Invisible, inputMode == 0)
    angleLabel.setFlag(SpriteFlag.Invisible, inputMode == 0)
}
controller.down.onEvent(ControllerButtonEvent.Repeated, function () {
    handleDirectionInput(0, -2, 0, 5)
})
controller.down.onEvent(ControllerButtonEvent.Pressed, function () {
    handleDirectionInput(0, -1, 0, 10)
})
function initTilemap () {
    hudTextColor = 1
    if (Math.percentChance(75)) {
        scene.setBackgroundColor(9)
        tiles.setTilemap(tilemap`level4`)
    } else if (Math.percentChance(75)) {
        scene.setBackgroundColor(9)
        tiles.setTilemap(tilemap`level5`)
    } else {
        scene.setBackgroundColor(11)
        tiles.setTilemap(tilemap`level6`)
    }
}
function updateActivePlayer (nextActive: number) {
    activePlayer = nextActive
    tankSprite = tankSprites[activePlayer]
    turretSprite = turretSprites[activePlayer]
    updateHUDValue(powerLabel, convertToText(sprites.readDataNumber(tankSprite, "shotPower")))
    updateHUDValue(angleLabel, convertToText(sprites.readDataNumber(tankSprite, "turretAngle")))
    activePlayerNotification = sprites.create(image.create(100, 9), SpriteKind.HUD)
    activePlayerNotification.image.fillRect(0, 0, activePlayerNotification.width, activePlayerNotification.height, 5)
    localExtensions.drawText5In(
    "" + sprites.readDataString(tankSprite, "playerName") + " turn...",
    activePlayerNotification.image,
    2,
    2,
    8
    )
    initHUDSprite(activePlayerNotification, 30, 32)
    activePlayerNotification.lifespan = 1800
}
function handleDirectionInput (rotationChange: number, powerChange: number, cameraOffsetXChange: number, cameraOffsetYChange: number) {
    if (inputMode == 0) {
        scene.centerCameraAt(scene.cameraLeft() + (scene.screenWidth() / 2 + cameraOffsetXChange), scene.cameraTop() + (scene.screenHeight() / 2 + cameraOffsetYChange))
    } else {
        sprites.changeDataNumberBy(tankSprite, "turretAngle", rotationChange)
        sprites.changeDataNumberBy(tankSprite, "shotPower", powerChange)
        drawTurrent()
    }
}
sprites.onDestroyed(SpriteKind.Projectile, function (sprite) {
    if (sprite.top <= 0) {
        shot = sprites.create(sprite.image, SpriteKind.OffscreenProjectile)
        shot.setPosition(sprite.x, sprite.y)
        shot.ay = sprite.ay
        shot.setVelocity(sprite.vx, sprite.vy)
        shot.setFlag(SpriteFlag.Ghost, true)
        shot.setFlag(SpriteFlag.DestroyOnWall, true)
        if (sprite == cameraSprite) {
            cameraFollowSprite(shot)
        }
    } else {
        if (!(sprite.isHittingTile(CollisionDirection.Left) || sprite.isHittingTile(CollisionDirection.Left))) {
            scene.cameraShake(2, 400)
        }
        viewTrigger = sprites.create(image.create(0, 0), SpriteKind.CameraTrigger)
        viewTrigger.lifespan = 600
    }
})
function positionSpriteRelativeTo (source: Sprite, offsetX: number, offsetY: number, spriteToPosition: Sprite) {
    spriteToPosition.setPosition(source.x + offsetX, source.y + offsetY)
}
controller.left.onEvent(ControllerButtonEvent.Repeated, function () {
    handleDirectionInput(3, 0, -5, 0)
})
/**
 * 1.0: initial release
 * 
 * 2.0:
 * 
 * - bugfix: fix bug moving to next player after a tank is destroyed (only affects 3+ player count games)
 * 
 * - add wind
 * 
 * - add two new (low probability) alternate levels
 * 
 * - prompt for player count
 */
let activePlayerNotification: Sprite = null
let legend: Sprite = null
let windLabel: Sprite = null
let windIndicator: Sprite = null
let hudTextColor = 0
let windLegend: Sprite = null
let panIndicator: Sprite = null
let angleLabel: Sprite = null
let powerLabel: Sprite = null
let viewTrigger: Sprite = null
let tankToDeleteIndex = 0
let cameraSprite: Sprite = null
let shot: Sprite = null
let offscreenVertically = false
let offscreenHorizontally = false
let inputMode = 0
let tankSprite: Sprite = null
let turretSprite: Sprite = null
let windSpeed = 0
let turretSpriteHalfWidth = 0
let turretLength = 0
let turretSprites: Sprite[] = []
let tankSprites: Sprite[] = []
let activePlayer = 0
let canShoot = false
let playerCount = 2
if (blockSettings.exists("tanks.playerCount")) {
    playerCount = blockSettings.readNumber("tanks.playerCount")
}
playerCount = localExtensions.askForNumber(
"How many players?",
2,
5,
playerCount
)
blockSettings.writeNumber("tanks.playerCount", playerCount)
canShoot = true
activePlayer = 0
tankSprites = sprites.allOfKind(SpriteKind.Player)
turretSprites = sprites.allOfKind(SpriteKind.Turret)
turretLength = 7
turretSpriteHalfWidth = 10
let maxWindSpeed = 20
let tankDesigns = [
img`
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . c c c . . . . . . . 
    . . . . c c c c c c c . . . . . 
    . . . . c 9 9 9 9 9 c . . . . . 
    . . . c 9 9 9 9 9 9 9 c . . . . 
    . . . c c 9 9 9 9 9 9 c . . . . 
    . c c c c c c c c c c c c c . . 
    . c d f b b b b b b b b d f c . 
    . c f f 9 9 9 9 9 9 9 9 f f c . 
    . c c c c c c c c c c c c c . . 
    `,
img`
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . 2 2 2 . . . . . . . 
    . . . . 2 2 2 2 2 2 2 . . . . . 
    . . . . 2 4 4 4 4 4 2 . . . . . 
    . . . 2 4 4 4 4 4 4 4 2 . . . . 
    . . . 2 2 4 4 4 4 4 4 2 . . . . 
    . 2 2 2 2 2 2 2 2 2 2 2 2 2 . . 
    . 2 3 f 5 5 5 5 5 5 5 5 3 f 2 . 
    . 2 f f 4 4 4 4 4 4 4 4 f f 2 . 
    . 2 2 2 2 2 2 2 2 2 2 2 2 2 . . 
    `,
img`
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . 6 6 6 . . . . . . . 
    . . . . 6 6 6 6 6 6 6 . . . . . 
    . . . . 6 7 7 7 7 7 6 . . . . . 
    . . . 6 7 7 7 7 7 7 7 6 . . . . 
    . . . 6 6 7 7 7 7 7 7 6 . . . . 
    . 6 6 6 6 6 6 6 6 6 6 6 6 6 . . 
    . 6 8 f 9 9 9 9 9 9 9 9 8 f 6 . 
    . 6 f f 7 7 7 7 7 7 7 7 f f 6 . 
    . 6 6 6 6 6 6 6 6 6 6 6 6 6 . . 
    `,
img`
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . a a a . . . . . . . 
    . . . . a a a a a a a . . . . . 
    . . . . a 3 3 3 3 3 a . . . . . 
    . . . a 3 3 3 3 3 3 3 a . . . . 
    . . . a a 3 3 3 3 3 3 a . . . . 
    . a a a a a a a a a a a a a . . 
    . a 5 f 1 1 1 1 1 1 1 1 5 f a . 
    . a f f 3 3 3 3 3 3 3 3 f f a . 
    . a a a a a a a a a a a a a . . 
    `,
img`
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . 4 4 4 . . . . . . . 
    . . . . 4 4 4 4 4 4 4 . . . . . 
    . . . . 4 5 5 5 5 5 4 . . . . . 
    . . . 4 5 5 5 5 5 5 5 4 . . . . 
    . . . 4 4 5 5 5 5 5 5 4 . . . . 
    . 4 4 4 4 4 4 4 4 4 4 4 4 4 . . 
    . 4 7 f 1 1 1 1 1 1 1 1 7 f 4 . 
    . 4 f f 5 5 5 5 5 5 5 5 f f 4 . 
    . 4 4 4 4 4 4 4 4 4 4 4 4 4 . . 
    `
]
initTilemap()
windSpeed = randint(0 - maxWindSpeed, maxWindSpeed)
initAllHUDSprites()
updateInputMode(0)
for (let index = 0; index <= playerCount - 1; index++) {
    turretSprite = sprites.create(image.create(21, 21), SpriteKind.Turret)
    tankSprite = sprites.create(tankDesigns[index % tankDesigns.length], SpriteKind.Player)
    tankSprites.push(tankSprite)
    turretSprites.push(turretSprite)
    sprites.setDataNumber(tankSprite, "turretAngle", randint(30, 150))
    sprites.setDataNumber(tankSprite, "shotPower", 100)
    sprites.setDataString(tankSprite, "playerName", "Player " + (index + 1))
    tiles.placeOnRandomTile(tankSprite, assets.tile`tile3`)
    positionSpriteRelativeTo(tankSprite, 0, 0, turretSprite)
    tiles.setTileAt(tiles.getTileLocation(Math.trunc(tankSprite.x / 16), Math.trunc(tankSprite.y / 16)), assets.tile`tile0`)
    drawTurrent()
}
for (let value of tiles.getTilesByType(assets.tile`tile3`)) {
    tiles.setTileAt(value, assets.tile`tile0`)
}
updateActivePlayer(activePlayer)
scene.centerCameraAt(tankSprite.x, tankSprite.y - 8)
game.onUpdate(function () {
    for (let value2 of sprites.allOfKind(SpriteKind.OffscreenProjectile)) {
        if (value2.top >= 0) {
            value2.setFlag(SpriteFlag.Ghost, false)
            value2.setKind(SpriteKind.Projectile)
        }
    }
})
